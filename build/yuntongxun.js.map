{"version":3,"sources":["yuntongxun.js"],"names":[],"mappings":";;;;;;;;;;;;IAGO,OAAO,2BAAM,YAAY;;IACzB,MAAM,2BAAM,QAAQ;;IACpB,MAAM,2BAAM,QAAQ;;IACpB,CAAC,2BAAM,QAAQ;;IAEhB,UAAU;AACH,WADP,UAAU,CACF,UAAU,EAAE,SAAS,EAAE,KAAK,EAAE,YAAY,EAAE;0BADpD,UAAU;;AAEZ,QAAI,CAAC,UAAU,GAAG,UAAU,CAAC;AAC7B,QAAI,CAAC,SAAS,GAAG,SAAS,CAAC;AAC3B,QAAI,CAAC,KAAK,GAAG,KAAK,CAAC;AACnB,QAAI,CAAC,OAAO,GAAG,YAAY,GAAG,8BAA8B,GAAG,qCAAqC,CAAC;AACrG,QAAI,CAAC,IAAI,GAAG,YAAY,CAAC;GAC1B;;eAPG,UAAU;AASd,QAAI;aAAA,cAAC,OAAO,EAAE,EAAE,EAAE;AAChB,YAAI,SAAS,GAAG,MAAM,EAAE,CAAC,MAAM,CAAC,gBAAgB,CAAC,CAAC;;AAElD,YAAI,GAAG,GAAG,MAAM,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,MAAM,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,SAAS,GAAG,SAAS,CAAC,CAAC,MAAM,CAAC,KAAK,CAAC,CAAC;AACtG,YAAI,aAAa,GAAG,IAAI,MAAM,MAAI,IAAI,CAAC,UAAU,SAAI,SAAS,CAAG,CAAC,QAAQ,CAAC,QAAQ,CAAC,CAAC;AACrF,YAAI,MAAM,QAAM,IAAI,CAAC,OAAO,6BAAwB,IAAI,CAAC,UAAU,6BAAwB,GAAG,AAAE,CAAC;;AAEjG,YAAI,KAAK,GAAG,CAAC,CAAC,QAAQ,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,MAAM,CAAC,OAAO,CAAC,IAAI,CAAC,GAAG,OAAO,CAAC,IAAI,CAAC;AAC7E,YAAI,OAAO,GAAG;AACZ,cAAM,OAAO,CAAC,EAAE;AAChB,iBAAS,IAAI,CAAC,KAAK;AACnB,sBAAc,OAAO,CAAC,QAAQ;AAC9B,iBAAS,KAAK;AAAA,SACf,CAAC;;AAEF,eAAO,OAAO,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,IAAI,CAAC,MAAM,CAAC,CAAC,MAAM,CAAC,MAAM,CAAC,CAAC,GAAG,CAAC,eAAe,EAAE,aAAa,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,GAAG,CAAC,UAAA,GAAG,EAAI;AACnH,cAAI,GAAG,CAAC,KAAK,EAAE;AACb,gBAAI,KAAK,GAAG,IAAI,KAAK,cAAY,MAAM,YAAS,CAAC;AACjD,iBAAK,CAAC,MAAM,GAAG,GAAG,CAAC,MAAM,CAAC;AAC1B,mBAAO,EAAE,CAAC,KAAK,CAAC,CAAC;WAClB;;AAED,cAAI,MAAM,GAAG,GAAG,CAAC,IAAI,CAAC;AACtB,cAAI,MAAM,CAAC,UAAU,KAAK,QAAQ,EAAE;AAClC,mBAAO,EAAE,CAAC,IAAI,EAAE,MAAM,CAAC,CAAC;WACzB,MAAM;AACL,gBAAI,KAAK,GAAG,IAAI,KAAK,CAAC,MAAM,CAAC,SAAS,CAAC,CAAC;AACxC,iBAAK,CAAC,MAAM,GAAG,QAAQ,CAAC,MAAM,CAAC,UAAU,IAAI,GAAG,EAAE,EAAE,CAAC,CAAC;AACtD,iBAAK,CAAC,GAAG,GAAG,GAAG,CAAC,IAAI,CAAC;AACrB,mBAAO,EAAE,CAAC,KAAK,CAAC,CAAC;WAClB;SACF,CAAC,CAAC;OACJ;;;;SAzCG,UAAU;;;iBA4CD,UAAU","file":"yuntongxun.js","sourcesContent":["/*\n云通讯 http://docs.yuntongxun.com/index.php/%E5%BC%80%E5%8F%91%E6%8C%87%E5%8D%97:%E7%9F%AD%E4%BF%A1%E9%AA%8C%E8%AF%81%E7%A0%81/%E9%80%9A%E7%9F%A5\n*/\nimport request from 'superagent';\nimport crypto from 'crypto';\nimport moment from 'moment';\nimport _ from 'lodash';\n\nclass YunTongXun {\n  constructor(accountSid, authToken, appId, isProduction) {\n    this.accountSid = accountSid;\n    this.authToken = authToken;\n    this.appId = appId;\n    this.baseUrl = isProduction ? 'https://app.cloopen.com:8883' : 'https://sandboxapp.cloopen.com:8883';\n    this.name = 'yuntongxun';\n  }\n\n  send(options, cb) {\n    let timestamp = moment().format('YYYYMMDDHHmmss');\n\n    let sig = crypto.createHash('md5').update(this.accountSid + this.authToken + timestamp).digest('hex');\n    let authorization = new Buffer(`${this.accountSid}:${timestamp}`).toString('base64');\n    let apiUrl = `${this.baseUrl}/2013-12-26/Accounts/${this.accountSid}/SMS/TemplateSMS?sig=${sig}`;\n\n    let datas = _.isObject(options.body) ? _.values(options.body) : options.body;\n    let content = {\n      \"to\": options.to,\n      \"appId\": this.appId,\n      \"templateId\": options.template,\n      \"datas\": datas // datas should be array\n    };\n\n    return request.post(apiUrl).type('json').accept('json').set('Authorization', authorization).send(content).end(res => {\n      if (res.error) {\n        let error = new Error(`Request ${apiUrl} error`);\n        error.status = res.status;\n        return cb(error);\n      }\n\n      let result = res.body;\n      if (result.statusCode === '000000') {\n        return cb(null, result);\n      } else {\n        let error = new Error(result.statusMsg);\n        error.status = parseInt(result.statusCode || 500, 10);\n        error.raw = res.text;\n        return cb(error);\n      }\n    });\n  }\n}\n\nexport default YunTongXun;"],"sourceRoot":"/source/"}